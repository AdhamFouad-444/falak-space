/* ============================================
   FALAk - Translation Engine & Dictionary
   ============================================ */

const TRANSLATIONS = {
    en: {
        // Nav
        "nav-journey": "Learning Path",
        "nav-features": "Features",
        "nav-join": "Join",
        "nav-cta": "Follow Progress",

        // Hero
        "hero-title": "AI-Powered Space Education",
        "hero-desc": "A specialized education system exploring how people learn, reason about, and prepare for space — starting with first principles.",
        "hero-btn-primary": "Explore the Framework",
        "hero-badge": "Launching Q2 2026 · Abu Dhabi, UAE",

        // Vision / Intro
        "intro-tag": "Our Vision",
        "intro-title": "Beyond Boundaries",
        "intro-p1": "FALAk is a long-term initiative focused on building understanding before infrastructure.",
        "intro-p2": "We begin with education, systems thinking, and exploration — creating a foundation that can later support real missions, teams, and capabilities.",

        // SimLab Section
        "sim-tag": "Interactive Learning",
        "sim-title": "Learning Through Structured Exploration",
        "sim-desc": "FALAk focuses on helping learners understand how space systems work before attempting to build them.",
        "sim-note": "Simulation tools will be introduced later as part of a staged learning approach.",

        // Education Header
        "edu-tag": "Learning Journey",
        "edu-title": "Your Path to the Stars",
        "fw-label": "Framework 001",
        "fw-subtitle": "From first principles to applied space systems",

        // Stats
        "stat-1-val": "Early Interest",
        "stat-1-lbl": "From students & educators",
        "stat-2-val": "Guided",
        "stat-2-lbl": "By subject matter experts",
        "stat-3-lbl": "Learning Stages",
        "stat-4-val": "UAE",
        "stat-4-lbl": "Abu Dhabi",

        // Features
        "feat-tag": "Why FALAk",
        "feat-title": "Education Built for Space",
        "feat-1-h": "AI-Powered Learning",
        "feat-1-p": "Personalized curriculum that adapts to your pace, background, and goals.",
        "feat-2-h": "Built for MENA",
        "feat-2-p": "Content in Arabic and English. Designed for learners across the region.",
        "feat-3-h": "Community-Driven",
        "feat-3-p": "Learn alongside peers. Connect with mentors from the space industry.",
        "feat-4-h": "Skill-Focused",
        "feat-4-p": "Developing relevant skills for the future space sector. Grounded in reality.",

        // CTA
        "cta-tag": "Open Initiative",
        "cta-title": "Building openly. Starting at the university level.",
        "cta-desc": "FALAk is currently being developed alongside a university society and early educational activities.<br>Public access will expand as the initiative matures.",
        "cta-btn": "Follow Our Progress",

        // Footer
        "footer-copy": "© 2026 FALAk · Abu Dhabi, UAE · Opening Pathways Into Space",

        // UI / Dynamic (New)
        "ui-section-prefix": "Section",
        "ui-lesson-label": "Lessons",
        "ui-close": "Close",
        "ui-prev": "Previous",
        "ui-next": "Next",
        "ui-outcome": "Learning Outcome",
        "ui-lesson-n": "Lesson",
        "ui-of": "of"
    },
    ar: {
        // Nav
        "nav-journey": "مسار التعلم",
        "nav-features": "المميزات",
        "nav-join": "انضم إلينا",
        "nav-cta": "تابع التقدم",

        // Hero
        "hero-title": "تعليم فضائي مدعوم بالذكاء الاصطناعي",
        "hero-desc": "نظام تعليمي متخصص يستكشف كيف يتعلم الناس ويفكرون ويستعدون للفضاء — بدءًا من المبادئ الأولى.",
        "hero-btn-primary": "استكشف الإطار",
        "hero-badge": "الإطلاق في الربع الثاني 2026 · أبوظبي، الإمارات",

        // Vision / Intro
        "intro-tag": "رؤيتنا",
        "intro-title": "ما وراء الحدود",
        "intro-p1": "فلك هي مبادرة طويلة المدى تركز على بناء الفهم قبل البنية التحتية.",
        "intro-p2": "نبدأ بالتعليم، والتفكير النظمي، والاستكشاف — لبناء أساس يمكنه لاحقًا دعم مهمات، وفرق، وقدرات حقيقية.",

        // SimLab Section
        "sim-tag": "تعلم تفاعلي",
        "sim-title": "التعلم عبر الاستكشاف المنظم",
        "sim-desc": "تركز فلك على مساعدة المتعلمين على فهم كيفية عمل الأنظمة الفضائية قبل محاولة بنائها.",
        "sim-note": "سيتم تقديم أدوات المحاكاة لاحقًا كجزء من نهج تعليمي مرحلي.",

        // Education Header
        "edu-tag": "رحلة التعلم",
        "edu-title": "مسارك نحو النجوم",
        "fw-label": "إطار العمل 001",
        "fw-subtitle": "من المبادئ الأولى إلى النظم الفضائية التطبيقية",

        // Stats
        "stat-1-val": "اهتمام مبكر",
        "stat-1-lbl": "من الطلاب والمعلمين",
        "stat-2-val": "توجيه",
        "stat-2-lbl": "بواسطة خبراء متخصصين",
        "stat-3-lbl": "مراحل للتعلم",
        "stat-4-val": "الإمارات",
        "stat-4-lbl": "أبوظبي",

        // Features
        "feat-tag": "لماذا فلك",
        "feat-title": "تعليم مصمم للفضاء",
        "feat-1-h": "تعلم مدعوم بالذكاء الاصطناعي",
        "feat-1-p": "منهج مخصص يتكيف مع وتيرتك، وخلفيتك العلمية، وأهدافك.",
        "feat-2-h": "صُمم للمنطقة",
        "feat-2-p": "محتوى باللغتين العربية والإنجليزية. مصمم للمتعلمين في جميع أنحاء المنطقة.",
        "feat-3-h": "بقيادة المجتمع",
        "feat-3-p": "تعلم جنبًا إلى جنب مع أقرانك. تواصل مع مرشدين من قطاع الفضاء.",
        "feat-4-h": "محور المهارات",
        "feat-4-p": "تطوير مهارات ذات صلة بقطاع الفضاء المستقبلي. محتوى واقعي وعملي.",

        // CTA
        "cta-tag": "مبادرة مفتوحة",
        "cta-title": "نبني بوضوح. البداية من المستوى الجامعي.",
        "cta-desc": "يتم تطوير فلك حاليًا جنبًا إلى جنب مع جمعية جامعية وأنشطة تعليمية مبكرة.<br>سيتوسع الوصول العام مع نضوج المبادرة.",
        "cta-btn": "تابع تقدمنا",

        // Footer
        "footer-copy": "© 2026 فلك · أبوظبي، الإمارات · فتح مسارات نحو الفضاء",

        // UI / Dynamic (New)
        "ui-section-prefix": "القسم",
        "ui-lesson-label": "دروس",
        "ui-close": "إغلاق",
        "ui-prev": "السابق",
        "ui-next": "التالي",
        "ui-outcome": "مخرجات التعلم",
        "ui-lesson-n": "الدرس",
        "ui-of": "من"
    }
};

const CURRICULUM_AR = {
    sections: [
        {
            id: "1",
            title: "ما هو الفضاء",
            subtitle: "فهم البيئة التي نعمل فيها",
            lessons: [
                { title: "تعريف الفضاء", content: "الفضاء ليس فراغًا. يبدأ الفضاء حيث ينتهي الطيران الديناميكي الهوائي وتسيطر ميكانيكا المدارات." },
                { title: "طبقات الغلاف الجوي", content: "التروبوسفير ← الستراتوسفير ← الميزوسفير ← الثيرموسفير ← الإكزوسفير." },
                { title: "لماذا الفضاء معادٍ", content: "لا هواء يعني لا رفع ولا تنفس. درجات حرارة متطرفة وإشعاع مستمر." },
                { title: "الحركة خارج الأرض", content: "الجاذبية لا تتوقف أبدًا. الأجسام في المدار في حالة سقوط حر مستمر." },
                { title: "فهم المدارات", content: "المدار مشكلة طاقة، وليست مشكلة ارتفاع." }
            ]
        },
        {
            id: "2",
            title: "كيف نصل إلى هناك",
            subtitle: "الطاقة، الدفع، والقيود",
            lessons: [
                { title: "مشكلة الإطلاق", content: "جاذبية الأرض تسحب كل شيء لأسفل. الغلاف الجوي يسبب السحب والحرارة." },
                { title: "لماذا الصواريخ؟", content: "الصواريخ تحمل المؤكسد الخاص بها. الدفع يعمل في الفراغ." },
                { title: "صاروخ كنظام", content: "الدفع، الهيكل، الوقود، التوجيه، والحمولة." },
                { title: "مشكلة الكتلة", content: "الوقود يسيطر على كتلة الصاروخ. الحمولة جزء صغير جدًا." },
                { title: "فصل المراحل", content: "إسقاط الوزن الميت يحسن الكفاءة." },
                { title: "ملف الإطلاق", content: "الإطلاق يبدأ عموديًا ثم يميل تدريجيًا." }
            ]
        },
        {
            id: "3",
            title: "عمليات الإطلاق",
            subtitle: "حيث تلتقي النظرية بالمخاطر",
            lessons: [
                { title: "تسلسل الإطلاق", content: "انتقال منضبط بين حالات النظام: آمن ← مسلح ← إشعال ← انطلاق." },
                { title: "الأنظمة الأرضية", content: "الإطلاق هو عملية أرضية في الغالب." },
                { title: "العد التنازلي", content: "استطلاعات القرار تتحقق من جميع الأنظمة." },
                { title: "فلسفة الإلغاء", content: "السلامة العامة هي الأولوية القصوى." }
            ]
        },
        {
            id: "4",
            title: "العمل في الفضاء",
            subtitle: "النجاة في فراغ الفضاء",
            lessons: [
                { title: "أنظمة المركبات", content: "توليد الطاقة، الاتصالات، التحكم الحراري، والتوجيه." },
                { title: "الفضاء كقيد", content: "الإشعاع يدمر الإلكترونيات. الفراغ يسبب تطاير الغازات." },
                { title: "الفشل والمخاطر", content: "نقاط الفشل الفردية يمكن أن تنهي المهام." }
            ]
        },
        {
            id: "5",
            title: "المحاكاة والذكاء الاصطناعي",
            subtitle: "ساحات الاختبار الافتراضية",
            lessons: [
                { title: "لماذا نستخدم المحاكاة", content: "تسمح بالتجريب الآمن وتصور القوى غير المرئية." },
                { title: "حدود المحاكاة", content: "المحاكاة ≠ التحقق. دائمًا هناك فجوة عن الواقع." },
                { title: "دور الذكاء الاصطناعي", content: "يخصص العمق والوتيرة، لكنه لا يخترع الفيزياء." }
            ]
        },
        {
            id: "6",
            title: "أنظمة متطرفة",
            subtitle: "دفع الفيزياء إلى الحدود القصوى",
            lessons: [
                { title: "لماذا الافتراضيات", content: "تكشف الحدود الصعبة للفيزياء." },
                { title: "دفع متقدم", content: "الأشرعة الضوئية، والمفاهيم النووية." },
                { title: "احتمالات طويلة المدى", content: "الفيزياء تضع الحدود النهائية." }
            ]
        },
        {
            id: "7",
            title: "الحدود والأخلاق",
            subtitle: "استكشاف مسؤول",
            lessons: [
                { title: "حدود تعليمية", content: "هذا الإطار تعليمي فقط. لا بناء، لا إطلاق." }
            ]
        }
    ]
};

class TranslationManager {
    constructor() {
        this.currentLang = localStorage.getItem('falak-lang') || 'en';
        this.toggleBtn = null;
        this.init();
    }

    init() {
        this.toggleBtn = document.getElementById('lang-toggle');
        if (this.toggleBtn) {
            this.toggleBtn.onclick = () => this.toggleLanguage();
            this.updateToggleText();
        }

        // Initial apply
        this.applyLanguage(this.currentLang);
    }

    t(key) {
        if (TRANSLATIONS[this.currentLang] && TRANSLATIONS[this.currentLang][key]) {
            return TRANSLATIONS[this.currentLang][key];
        }
        // Fallback to EN
        return TRANSLATIONS['en'] ? TRANSLATIONS['en'][key] : key;
    }

    toggleLanguage() {
        this.currentLang = this.currentLang === 'en' ? 'ar' : 'en';
        localStorage.setItem('falak-lang', this.currentLang);
        this.applyLanguage(this.currentLang);
        this.updateToggleText();
    }

    updateToggleText() {
        if (this.toggleBtn) {
            this.toggleBtn.textContent = this.currentLang === 'en' ? 'AR' : 'EN';
        }
    }

    applyLanguage(lang) {
        const doc = document.documentElement;
        const body = document.body;

        doc.lang = lang;
        doc.dir = lang === 'ar' ? 'rtl' : 'ltr';

        if (lang === 'ar') {
            body.classList.add('rtl');
            body.classList.remove('ltr');
        } else {
            body.classList.add('ltr');
            body.classList.remove('rtl');
        }

        // Apply string translations
        const strings = TRANSLATIONS[lang];
        for (const [id, text] of Object.entries(strings)) {
            const el = document.getElementById(id);
            if (el) {
                // If special handling is needed (e.g. keeping icon in button)
                // For now assuming pure text replacement or innerHTML keying
                el.innerHTML = text;
            }
        }

        // Re-render Curriculum if it exists
        if (typeof initCurriculumUI === 'function') {
            initCurriculumUI();
        }

        // Re-render Lesson Modal if open
        if (typeof renderLesson === 'function' && document.getElementById('lesson-modal') && document.getElementById('lesson-modal').style.display === 'block') {
            renderLesson();
        }
    }

    getCurriculumData(originalData) {
        if (this.currentLang === 'en') return originalData;

        // Merge AR titles/content into the structure
        // Deep copy structure to avoid mutating original
        const combined = JSON.parse(JSON.stringify(originalData));

        combined.sections.forEach((sec, idx) => {
            if (CURRICULUM_AR.sections[idx]) {
                sec.title = CURRICULUM_AR.sections[idx].title;
                // We'll also inject the subtitle logic in `initCurriculumUI` by looking up localized subtitles
            }
            sec.lessons.forEach((less, lIdx) => {
                if (CURRICULUM_AR.sections[idx].lessons[lIdx]) {
                    less.title = CURRICULUM_AR.sections[idx].lessons[lIdx].title;
                    less.content = CURRICULUM_AR.sections[idx].lessons[lIdx].content;
                    if (CURRICULUM_AR.sections[idx].lessons[lIdx].learningOutcome) {
                        less.learningOutcome = CURRICULUM_AR.sections[idx].lessons[lIdx].learningOutcome;
                    }
                }
            });
        });

        return combined;
    }

    getLocalizedSubtitles() {
        if (this.currentLang === 'en') return null; // Use default

        const map = {};
        CURRICULUM_AR.sections.forEach(sec => {
            map[sec.id] = sec.subtitle;
        });
        return map;
    }
}

// Global instance
let appTranslator;
document.addEventListener('DOMContentLoaded', () => {
    appTranslator = new TranslationManager();
});
